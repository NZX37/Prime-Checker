<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Murder Drones is Good</title>
  <style>
    body {
      font-family: 'Bahnschrift', sans-serif;
      background: #58566B;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 750px;
      margin: auto;
      background: #41DDAE;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .message {
      margin: 15px 0;
      padding: 10px;
      border-left: 4px solid;
      border-radius: 5px;
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
    }
    .pinned {
      background-color: #D69E98;
      border-left-color: #A92617;
    }
    .recent {
      background-color: #8BA0BE;
      border-left-color: #314159;
    }
    .older {
      background-color: #B5B5B5;
      border-left-color: #111111;
    }
    .TPOT {
      background-image: url('https://wallpapercave.com/wp/wp13307308.jpg');
    }
    .Winner {
      background: linear-gradient(to right, #97a1ff, #abb3fe);
    }
    .BAGGED {
      background: linear-gradient(to right, #b1ffd7, #feaedb, #b1ffd7);
    }
    .meta {
      font-size: 0.85em;
      color: #fff;
      margin-top: 5px;
      text-shadow: 0 0 3px #000;
    }
    strong {
      color: #fff;
      text-shadow: 0 0 3px #000;
    }
    input[type="text"] {
      width: 60%;
      padding: 8px;
      margin: 4px;
    }
    button {
      padding: 8px 12px;
      background: #d2373a;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #672b2d;
    }
    .section-title {
      margin-top: 30px;
      font-size: 1.2rem;
      border-bottom: 2px solid #01489b;
      padding-bottom: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Post a notice</h2>
    <input id="username" type="text" placeholder="Your name" />
    <input id="msg" type="text" placeholder="Your message" />
    <label><input type="checkbox" id="pin" /> Pin</label>
    <button onclick="submitMsg()">Submit</button>

    <h3 class="section-title">Pinned Messages</h3>
    <div id="pinned"></div>

    <h3 class="section-title">Recent Messages</h3>
    <div id="recent"></div>

    <h3 class="section-title" onclick="toggleOlder()" style="cursor:pointer;">Older Messages ▼</h3>
    <div id="older" style="display:none;"></div>
  </div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyst6jClS_BULqyh5gndkPKeZW7gfhZstMbrWKuI4AKWd9dxLlo2V3ztyP3nJErC2HT/exec";

    async function submitMsg() {
      const msg = document.getElementById('msg').value.trim();
      const name = document.getElementById('username').value.trim() || "Anonymous";
      const pinned = document.getElementById('pin').checked;

      if (!msg) return alert("Message cannot be empty!");

      await fetch(scriptURL, {
        method: 'POST',
        body: new URLSearchParams({
          message: msg,
          name: name,
          pinned: pinned,
          parentID: ""
        })
      });

      document.getElementById('msg').value = '';
      document.getElementById('pin').checked = false;

      loadMessages();
    }

    function toggleOlder() {
      const olderDiv = document.getElementById('older');
      olderDiv.style.display = olderDiv.style.display === 'none' ? 'block' : 'none';
    }

    function isOlderThanOneDay(timestamp) {
      const now = new Date();
      const then = new Date(timestamp);
      return now - then > 86400000;
    }

    function userImageClass(username) {
      return ["TPOT", "Winner", "BAGGED"].includes(username) ? username : '';
    }

    async function loadMessages() {
      const res = await fetch(scriptURL);
      const data = await res.json();

      const pinnedDiv = document.getElementById('pinned');
      const recentDiv = document.getElementById('recent');
      const olderDiv = document.getElementById('older');

      pinnedDiv.innerHTML = '';
      recentDiv.innerHTML = '';
      olderDiv.innerHTML = '';

      data.reverse().forEach(m => {
        const container = m.pinned === true || m.pinned === "TRUE" ? pinnedDiv : isOlderThanOneDay(m.timestamp) ? olderDiv : recentDiv;
        const timeClass = m.pinned === true || m.pinned === "TRUE" ? 'pinned' : isOlderThanOneDay(m.timestamp) ? 'older' : 'recent';
        const userClass = userImageClass(m.name);

        const block = document.createElement('div');
        block.className = `message ${timeClass} ${userClass}`;
        block.innerHTML = `
          <strong>${m.message}</strong>
          <div class="meta">by ${m.name} • ${new Date(m.timestamp).toLocaleString()}</div>
        `;

        container.appendChild(block);
      });
    }

    loadMessages();
  </script>
</body>
</html>
