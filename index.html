<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Murder Drones is Good</title>
  <style>
    body {
      font-family: 'Bahnschrift', sans-serif;
      background: #58566B;
      padding: 20px;
      color: #333;
    }
    .container { max-width: 750px; margin: auto; background: #41DDAE; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .message, .reply { margin: 15px 0; padding: 10px; background: #c3f6f7; border-left: 4px solid #1a7878; border-radius: 5px; }
    .reply { margin-left: 30px; border-left-color: #FCC323; background: #E1D2A7; }
    uop.meta { font-size: 0.85em; color: #666; margin-top: 5px; }
    .reply-form { margin-left: 30px; margin-top: 10px; }
    input[type="text"] { width: 60%; padding: 8px; margin: 4px; }
    button { padding: 8px 12px; background: #d2373a; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #672b2d; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Post a notice</h2>
    <input id="username" type="text" placeholder="Your name" />
    <input id="msg" type="text" placeholder="Your message" />
    <button onclick="submitMsg()">Submit</button>

    <h3>Messages</h3>
    <div id="messages"></div>
  </div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyst6jClS_BULqyh5gndkPKeZW7gfhZstMbrWKuI4AKWd9dxLlo2V3ztyP3nJErC2HT/exec";

    async function submitMsg(parentID = "") {
      const msg = document.getElementById(parentID ? `reply-${parentID}` : 'msg').value.trim();
      const name = document.getElementById('username').value.trim() || "Anonymous";

      if (!msg) return alert("Message cannot be empty!");

      await fetch(scriptURL, {
        method: 'POST',
        body: new URLSearchParams({
          message: msg,
          name: name,
          pinned: false,
          parentID: parentID
        })
      });

      loadMessages();
    }

    async function loadMessages() {
      const res = await fetch(scriptURL);
      const data = await res.json();

      const messages = {};
      const replies = {};

      data.forEach(m => {
        const id = m.timestamp;
        if (m.parentID) {
          if (!replies[m.parentID]) replies[m.parentID] = [];
          replies[m.parentID].push(m);
        } else {
          messages[id] = m;
        }
      });

      const container = document.getElementById('messages');
      container.innerHTML = '';

      Object.keys(messages).reverse().forEach(id => {
        const m = messages[id];
        const block = document.createElement('div');
        block.className = 'message';
        block.innerHTML = `
          <strong>${m.message}</strong>
          <div class="meta">by ${m.username} • ${new Date(m.timestamp).toLocaleString()}</div>
          <div class="reply-form">
            <input type="text" id="reply-${id}" placeholder="Reply..." />
            <button onclick="submitMsg('${id}')">Reply</button>
          </div>
        `;

        if (replies[id]) {
          replies[id].forEach(r => {
            const reply = document.createElement('div');
            reply.className = 'reply';
            reply.innerHTML = `
              <strong>${r.message}</strong>
              <div class="meta">by ${r.username} • ${new Date(r.timestamp).toLocaleString()}</div>
            `;
            block.appendChild(reply);});}

        container.appendChild(block);
      });
    }

    loadMessages();
  </script>
</body>
</html>
